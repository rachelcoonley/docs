<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Kubernetes Ingress Support in Rancher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for Rancher">
    <link href="/docs/favicon.png" rel="shortcut icon" type="image/png" sizes="16x16">
    <link href="/docs/css/syntax.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/vendor/font-awesome/css/font-awesome.min.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/vendor/lato/lato.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/lacsso.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/slicknav.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/rancher-docs.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
  </head>
  <body class="bg-default">
    <div class="row body">
      <header id="header" class="section">
        <nav class="row" role="navigation">
          <div class="col span-3">
          <a class="navbar-brand" href="/"><img src="/docs/img/rancher-logo-nopadding.svg" width="200px" style="padding-left: 20px" /></a>
          </div>

          <div class="col span-5 offset-3">
            <!--Start Google Search-->
            <div class="gcse-search" id="google-search"></div>
            <script>
              var match = window.location.pathname.match(/\/rancher\/([^\/]+)/);
              if ( match ) {
                document.getElementById('google-search').setAttribute('data-defaultToRefinement', match[1]);
              }

              (function() {
                var cx = '007896692384436596364:60akf3bfmxm';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <!--End Google Search-->
          </div>
        </nav>
      </header>
      <div class="col span-3 mt-0 mr-0 sidebar">

<ul id="menu">
    <li><a href="/docs/rancher/v1.6/en/">Overview</a></li>
    <li><a href="/docs/rancher/v1.6/en/quick-start-guide/">Quick Start Guide</a></li>
    <li>
        <a href="#">Installing Rancher<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/">Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#requirements">Rancher Server Requirements</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#rancher-server-tags">Rancher Server Tags</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container">Launching Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#multi-nodes">Setting up HA</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#requirements-for-ha">HA Requirements</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container-external-database">Using an External DB</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container-bind-mount">Bind Mounted MySQL Volume</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#elb">Using an ELB in AWS</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#ldap">Using LDAP/AD with TLS</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#http-proxy">Behind an HTTP Proxy</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/selinux/">SELinux Requirements for RHEL/CentOS</a></li>
          <li>
               <a href="#">Basic SSL Configuration<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#requirements">Requirements</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-nginx-configuration">Example NGINX Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-apache-configuration">Example Apache Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-haproxy-configuration">Example HAProxy Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-f5-big-ip-configuration">Example F5 BIG-IP Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#elb">Using an ELB in AWS with SSL</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#using-self-signed-certs-beta">Using Self Signed Certs</a></li>
               </ul>
          </li>
          <li>
               <a href="#">No Internet Access<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/no-internet-access/#using-a-private-registry">Using a Private Registry</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/no-internet-access/#using-an-http-proxy">Using an HTTP Proxy</a></li>
               </ul>
          </li>
        </ul>
    </li>
    <li>
         <a href="#">Upgrading Rancher<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li><a href="/docs/rancher/v1.6/en/upgrading/">Upgrading Rancher</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#rancher-server-tags">Rancher Server Tags</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#infrastructure-services">Upgrading Infrastructure Services</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#multi-nodes">Upgrading Rancher HA Setup</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#single-container-external-database">Using an external DB</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#single-container-bind-mount">Bind Mounted MySQL Volume</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#rancher-server-with-no-internet-access">No Internet Access</a></li>
        </ul>
     </li>
    <li>
         <a href="#">Rancher Configuration<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li>
                <a href="#">Access Control Providers<i class="pull-right fa fa-angle-down"></i></a>
                <ul>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#active-directory">Active Directory</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#azure-ad">Azure AD</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#github">Github</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#local-authentication">Local Authentication</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#openldap">OpenLDAP</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#shibboleth">Shibboleth/SAML</a></li>
                </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#site-access">Rancher Site Access</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#restricting-concurrent-sessions">Restricting Concurrent Sessions</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/accounts/">Accounts</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/settings/#host-registration">Host Registration</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/settings/#catalog">Enabling Catalogs</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/machine-drivers/">Machine Drivers</a></li>
        </ul>
    </li>
    <li>
          <a href="#">Environments<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
            <li><a href="/docs/rancher/v1.6/en/environments/">Managing Environments</a></li>
            <li><a href="/docs/rancher/v1.6/en/environments/#what-is-an-environment-template">Environment Templates</a></li>
            <li><a href="/docs/rancher/v1.6/en/environments/#membership-roles">Roles in an Environment</a></li>
          </ul>
    </li>
    <li>
        <a href="#">Hosts<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/en/hosts/">Getting Started with Hosts</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#supported-docker-versions">Supported Docker Versions</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#host-labels">Adding Host Labels</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#scheduler-ips">Adding Scheduler IPs</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#hosts-behind-an-http-proxy">Behind an HTTP Proxy</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/custom/">Adding Custom Hosts</a></li>
          <li>
              <a href="#">Adding Cloud Provided Hosts<i class="pull-right fa fa-angle-down"></i></a>
              <ul>
                <li><a href="/docs/rancher/v1.6/en/hosts/amazon/">Adding Amazon EC2 Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/azure/">Adding Azure Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/digitalocean/">Adding DigitalOcean Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/exoscale/">Adding Exoscale Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/packet/">Adding Packet Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/rackspace/">Adding Rackspace Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/other/">Adding Hosts from Other Cloud Providers</a></li>
              </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#accessing-hosts-from-the-cloud-providers">Accessing Cloud Provided Hosts</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#removing-hosts">Removing Hosts</a></li>
        </ul>
    </li>
    <li>
      <a href="#">Registries<i class="pull-right fa fa-angle-down"></i></a>
      <ul>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/">Adding Private Registries</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#insecure-registries">Insecure Registries</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#self-signed-certificates">Self Signed Certificates</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#using-amazons-ecr-registry">Using Amazon's ECR</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#using-google-container-registry">Using Google Container Registry</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#changing-the-default-registry">Changing the Default Registry</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#limiting-which-registries-can-be-used">Limiting Registries</a></li>
      </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/environments/certificates/">Certificates</a></li>
    <li>
      <a href="#">Infrastructure Services<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/">Infrastructure Services</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/networking/">Networking</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/network-policy/">Network Policies</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/load-balancer">Load Balancer</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/dns-service/">DNS Service</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/metadata-service/">Metadata Service</a></li>
              <li>
                  <a href="#">Persistent Storage Service<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/">Persistent Storage Service</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/rancher-nfs/">Rancher NFS</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/rancher-ebs/">Rancher EBS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">External Scheduler<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/">External Scheduler</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#multiple-ips">Scheduling against multiple IPs</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#resource-constraints">Scheduling with Resource Constraints</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#restrict-services-on-host">Scheduling only Specific Services on a Host</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/audit-log/">Audit Logging</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/service-accounts/">Service Accounts</a></li>
           </ul>
    </li>
    <li>
          <a href="#">Cattle<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
                <li><a href="/docs/rancher/v1.6/en/cattle/stacks/">Stacks</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-services/">Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/volumes/">Volumes</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/">Load Balancers</a></li>
                <li>
                    <a href="#">Load Balancer Options in the UI<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#adding-a-load-balancer-in-the-ui">Adding Load Balancers</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#service-rule">Targeting Specific Services</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#selector-rule">Targeting Services based on Selectors</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#ssl-termination">SSL Termination</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#stickiness-policy-for-load-balancers">Stickiness Policy</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#custom-haproxy-configuration">Custom HAProxy Configuration</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#labelsscheduling-load-balancers">Labels and Scheduling</a></li>
                      </ul>
                </li>
                <li>
                    <a href="#">Load Balancer Options with CLI and Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#adding-a-load-balancer-with-rancher-compose">Adding Load Balancers</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#source-ports">Defining Source Ports</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#port-rules">Port Rules</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#certificates">Certificates</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#custom-configuration">Custom HAProxy Configuration</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#stickiness-policy">Stickiness Policy</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#load-balancer-example-l7">Example of L7 Load Balancer</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#internal-load-balancer-example">Example of Internal Load Balancer</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#ssl-termination-example">Example of SSL Termination with a Load Balancer</a></li>
                      </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-external-services/">External Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-service-alias/">Service Alias</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/health-checks/">Health Checks</a></li>
                <li>
                    <a href="#">Scheduling Services<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/">Scheduling</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#scheduling-options-in-the-ui">Scheduling in the UI</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#adding-labels-in-rancher-compose">Scheduling in Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#table-of-scheduling-labels">Table of Scheduling Labels</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/upgrading/">Upgrading Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/internal-dns-service/">Internal DNS Service in Cattle Environments</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/external-dns-service/">External DNS Service</a></li>
                <li>
                    <a href="#">Rancher-Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/">Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/commands/">Commands and Options</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/environment-interpolation/">Environment Interpolation</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/build/">Building with AWS S3</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/secrets/">Secrets - Experimental</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/webhook-service/">Webhooks</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/labels/">Labels in Cattle</a></li>
          </ul>
    </li>
    <li>
          <a href="#">Kubernetes<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/">Launching Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/resiliency-planes/">Resiliency Planes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/providers/">Cloud Providers</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/private-registry/">Private Registry</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/rbac/">RBAC</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/disaster-recovery/">Disaster Recovery</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/backups/">Backups</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/storage/">Persistent Storage</a></li>
              <li>
                  <a href="#">Add-ons Support<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/">Add-ons Support</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/#helm">Helm</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/#skydns">SkyDNS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">Ingress Support and Options<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/">Ingress Support</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#host-based-routing">Host Based Routing</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#path-based-routing">Path Based Routing</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#scale-and-other-port">Multiple Load Balancers and Selecting Ports</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#tls">Using TLS</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#blocking-http">Blocking HTTP</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#custom-haproxy">Custom HAProxy</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#scheduled-globally">Scheduling on all Hosts</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#host-scheduling">Scheduling on a specific Host</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#only-local">Targeting Only Containers on the Same Host</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#prefer-local">Prioritizing Containers on the Same Host</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/upgrading/">Upgrading Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/deleting/">Deleting Kubernetes</a></li>

          </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/mesos/">Mesos</a></li>
    <li><a href="/docs/rancher/v1.6/en/swarm/">Swarm - Experimental </a></li>
    <li><a href="/docs/rancher/v1.6/en/windows/">Windows - Experimental</a></li>
    <li><a href="/docs/rancher/v1.6/en/native-docker/">Using Native Docker CLI</a></li>
    <li>
            <a href="#">Rancher Catalog<i class="pull-right fa fa-angle-down"></i></a>
            <ul>
                <li><a href="/docs/rancher/v1.6/en/catalog/">Catalog</a></li>
                <li><a href="/docs/rancher/v1.6/en/catalog/private-catalog/">Creating Private Catalogs</a></li>
            </ul>
        </li>
    <li><a href="#">Rancher CLI<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/en/cli/">Rancher CLI</a></li>
            <li><a href="/docs/rancher/v1.6/en/cli/commands/">Commands and Options</a></li>
            <li><a href="/docs/rancher/v1.6/en/cli/variable-interpolation/">Variable Interpolation</a></li>
        </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/api/v2-beta/">API Documentation</a></li>
    <li><a href="/docs/rancher/v1.6/en/contributing/">Contributing to Rancher</a></li>
    <li>
        <a href="#">FAQs<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/en/faqs/server/">FAQs about Rancher Server</a></li>
            <li><a href="/docs/rancher/v1.6/en/faqs/agents/">FAQs about Rancher Agents/Hosts</a></li>
            <li><a href="/docs/rancher/v1.6/en/faqs/troubleshooting/">Troubleshooting FAQS</a></li>
        </ul>
    </li>
    <li>
        <a href="#">Docs Archive<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.5/en/">Rancher v1.5</a></li>
            <li><a href="/docs/rancher/v1.4/en/">Rancher v1.4</a></li>
            <li><a href="/docs/rancher/v1.3/en/">Rancher v1.3</a></li>
            <li><a href="/docs/rancher/v1.2/en/">Rancher v1.2</a></li>
            <li><a href="/docs/rancher/v1.1/en/">Rancher v1.1</a></li>
            <li><a href="/docs/rancher/v1.0/en/">Rancher v1.0</a></li>
        </ul>
    </li>
</ul>

      </div>

      <div class="col span-8">
        <div class="content-container">
          <h2 id="ingress-support">Ingress Support</h2>
<hr />

<p>Before being able to start using <a href="http://kubernetes.io/docs/user-guide/ingress/">Kubernetes Ingress resources</a>, you’ll need to have an <a href="/docs/rancher/v1.6/en/environments/">environment</a> that has an orchestation type as  Kubernetes. We also recommend <a href="/docs/rancher/v1.6/en/kubernetes/#kubectl">setting up <code class="highlighter-rouge">kubectl</code> on your local machine</a> to make it easier to launch Kubernetes resources into Rancher. Alternatively, you can use the shell provided by the Rancher UI to launch resources.</p>

<p>The Kubernetes Ingress resource can be backed up by any load balancer of your choice, so to leverage the Rancher’s load balancing functionality, we have introduced the concept of a Rancher ingress controller. The ingress controller is created as part of ingress-controller service, which gets deployed as part of the system stack for Kubernetes.</p>

<p>The ingress controller manages the creation/removal/update of Rancher load balancers. Each load balancer is created/removed/updated based on the Kubernetes ingress resources. If an ingress is updated or service endpoints are changed, the ingress controller will update the corresponding Rancher load balancer to the changes in the ingress. Similarly, if the ingress is removed, the Rancher load balancer will be removed as well. If the backend services of an ingress has changes (e.g. when a replication controller is scaled up or down or a pod gets recreated), the Rancher load balancer will be updated accordingly. The ingress controller ensures that the Rancher load balancer matches the ingress and backend services in Kubernetes.</p>

<h3 id="current-limitations">Current Limitations</h3>

<ul>
  <li>Ingress resources can only be added through <code class="highlighter-rouge">kubectl</code></li>
</ul>

<h3 id="rancher-ingress-controller">Rancher Ingress Controller</h3>

<p>The Rancher ingress controller will leverage the existing load balancing functionality within Rancher and convert what is in Kubernetes ingress to a load balancer in Rancher.</p>

<p>The ingress controller will:</p>

<ul>
  <li>Listen to Kubernetes server events</li>
  <li>Deploy a load balancer and program it with the routing rules defined in Ingress</li>
  <li>Configure the Ingress <code class="highlighter-rouge">Address</code> field with the Public Endpoint of your Load Balancer</li>
</ul>

<h3 id="creating-ingress-resources-in-rancher">Creating Ingress resources in Rancher</h3>

<h4 id="setting-up-an-example-nginx-service">Setting up an Example Nginx Service</h4>

<p>Before setting up any ingress, services will need to be created in Kubernetes. We’ll start by adding a service and replication controller into our Kubernetes environment.</p>

<p>Here’s a simple nginx service to add into Kubernetes.</p>

<p>Example <code class="highlighter-rouge">nginx-service.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>Using <code class="highlighter-rouge">kubectl</code>, let’s launch our nginx service into Kubernetes. Remember, you can either <a href="/docs/rancher/v1.6/en/kubernetes/#kubectl">configure <code class="highlighter-rouge">kubectl</code> for your local machine</a> or you can use the shell in the UI under <strong>Kubernetes</strong> -&gt; <strong>kubectl</strong>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f nginx-service.yml
service <span class="s2">"nginx-service"</span> created
replicationcontroller <span class="s2">"nginx-service"</span> created
</code></pre>
</div>

<p><a id="simple-ingress"></a></p>

<h4 id="setting-up-a-simple-ingress-resource">Setting up a Simple Ingress Resource</h4>

<p>You can set up a simple ingress resource for the single service.</p>

<p>Example <code class="highlighter-rouge">simple-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">simplelb</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>Let’s create the ingress using <code class="highlighter-rouge">kubectl</code>. After you create the ingress, the ingress controller will trigger a load balancer service to be created and visible in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab. By default, the load balancer service will only have 1 instance of the load balancer deployed. From <code class="highlighter-rouge">kubectl</code>, you can see the ingress created, but the UI will only show the load balancer. The ingress controller has already done all the translations of the requests in the ingress to a Rancher load balancer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f simple-ingress.yml
ingress <span class="s2">"simplelb"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME          RULE      BACKEND            ADDRESS          AGE
simplelb      -         nginx-service:80   1.2.3.4          5m
</code></pre>
</div>

<p>The <code class="highlighter-rouge">address</code> in the ingress will be the public endpoint of where the load balancer service was launched. If the load balancer is moved to a different host and gets a different public endpoint, the ingress <code class="highlighter-rouge">address</code> will be updated.</p>

<p>To access your application, you can hit the address at our default port <code class="highlighter-rouge">80</code> (i.e. <code class="highlighter-rouge">http://1.2.3.4:80</code>) or the address directly (i.e. <code class="highlighter-rouge">http://1.2.3.4</code>).</p>

<h4 id="setting-up-multiple-services">Setting up Multiple Services</h4>

<p>If you want the ingress to act as an entry point for more than one service, then it will need to be configured with  host name routing rules, which allows adding host/path based routing to services.</p>

<p>Let’s start by adding multiple services into Kubernetes.</p>

<p>Example <code class="highlighter-rouge">multiple-nginx-services.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>Using <code class="highlighter-rouge">kubectl</code>, let’s launch our services and replication controllers into Kubernetes. Remember, you can either <a href="/docs/rancher/v1.6/en/kubernetes/#kubectl">configure <code class="highlighter-rouge">kubectl</code> for your local machine</a> or you can use the shell in the UI under <strong>Kubernetes</strong> -&gt; <strong>kubectl</strong>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f multiple-nginx-services.yml
service <span class="s2">"nginx-service-1"</span> created
replicationcontroller <span class="s2">"nginx-service-1"</span> created
service <span class="s2">"nginx-service-2"</span> created
replicationcontroller <span class="s2">"nginx-service-2"</span> created
</code></pre>
</div>

<p><a id="host-based-routing"></a></p>

<h4 id="setting-up-a-ingress-resource-with-host-based-routing">Setting up a Ingress Resource with Host Based Routing</h4>

<p>Example <code class="highlighter-rouge">host-based-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">host-based-ingress</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">foo.bar.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">bar.foo.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>Let’s create the ingress using <code class="highlighter-rouge">kubectl</code>. After you create the ingress, the ingress controller will trigger a load balancer service to be created and visible in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab. By default, the load balancer service will only have 1 instance of the load balancer deployed. The load balancer will have the host name routing rules created from the ingress.</p>

<p>From <code class="highlighter-rouge">kubectl</code>, you can see the ingress created, but the UI will only show the load balancer. The ingress controller has already done all the translations of the requests in the ingress to a Rancher load balancer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f host-based-ingress.yml
ingress <span class="s2">"host-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME                    RULE            BACKEND             ADDRESS     AGE
host-based-ingress      -                                   1.2.3.4     20m
                        foo.bar.com    
                                        nginx-service-1:80
                        foo1.bar.com   
                                        nginx-service-2:80
</code></pre>
</div>

<p>Similar to the simple ingress load balancer, this load balancer will be in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab.</p>

<p>The <code class="highlighter-rouge">address</code> in the ingress will be the public endpoint of where the load balancer service was launched. If the load balancer is moved to a different host and gets a different public endpoint, the ingress <code class="highlighter-rouge">address</code> will be updated.</p>

<p>To access your application, you can hit the address at our default port <code class="highlighter-rouge">80</code> (i.e. <code class="highlighter-rouge">http://1.2.3.4:80</code>) or the address directly (i.e. <code class="highlighter-rouge">http://1.2.3.4</code>).</p>

<p><a id="path-based-routing"></a></p>

<h4 id="setting-up-a-ingress-resource-with-path-based-routing">Setting up a Ingress Resource with Path Based Routing</h4>

<p>If we have multiple services that you want load balanced, then you could add path based routing to your ingress.</p>

<p>Example <code class="highlighter-rouge">path-based-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">path-based-ingress</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">host</span><span class="pi">:</span> <span class="s">foo.bar.com</span>
    <span class="s">http</span><span class="pi">:</span>
      <span class="s">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">path</span><span class="pi">:</span> <span class="s">/foo</span>
        <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-1</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
      <span class="pi">-</span> <span class="s">path</span><span class="pi">:</span> <span class="s">/bar</span>
        <span class="s">backend</span><span class="pi">:</span>
          <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service-2</span>
          <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>Let’s create the ingress using <code class="highlighter-rouge">kubectl</code>. After you create the ingress, the ingress controller will trigger a load balancer to be created and visible in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab. By default, the load balancer service will only have 1 instance of the load balancer deployed. The load balancer will have the host name routing rules created from the ingress.</p>

<p>From <code class="highlighter-rouge">kubectl</code>, you can see the ingress created, but the UI will only show the load balancer. The ingress controller has already done all the translations of the requests in the ingress to a Rancher load balancer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f path-based-ingress.yml
ingress <span class="s2">"path-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME                    RULE            BACKEND             ADDRESS            AGE
path-based-ingress      -                                   1.2.3.4             15s
                        foo.bar.com    
                        /foo            nginx-service1:80
                        /bar            nginx-service2:80
</code></pre>
</div>

<p>Similar to the simple ingress load balancer, this load balancer will be in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab.</p>

<p>The <code class="highlighter-rouge">address</code> in the ingress will be the public endpoint of where the load balancer service was launched. If the load balancer is moved to a different host and gets a different public endpoint, the ingress <code class="highlighter-rouge">address</code> will be updated.</p>

<p>To access your application, you can hit the address at our default port <code class="highlighter-rouge">80</code> (i.e. <code class="highlighter-rouge">http://1.2.3.4:80</code>) or the address directly (i.e. <code class="highlighter-rouge">http://1.2.3.4</code>).</p>

<h3 id="load-balancer-options-with-kubernetes-ingress">Load Balancer Options with Kubernetes Ingress</h3>

<p>By default, a Kubernetes ingress will deploy 1 load balancer on only 1 host using http/https on default ports <code class="highlighter-rouge">80</code>/<code class="highlighter-rouge">443</code>. Rancher has added the ability to support multiple load balancers using the port of your choice. By scaling the ingress, the address programmed in Kubernetes will also reflect all the hosts that have the load balancer available.</p>

<h4 id="examples">Examples:</h4>

<ul>
  <li><a href="#scale-and-other-port">Multiple Load Balancers using a Different Port</a></li>
  <li><a href="#tls">Using TLS</a></li>
  <li><a href="#blocking-http">Blocking HTTP</a></li>
  <li><a href="#custom-haproxy">Custom HAProxy</a></li>
  <li><a href="#scheduled-globally">Load Balancers scheduled on all Hosts</a></li>
  <li><a href="#host-scheduling">Load Balancers scheduled on a specific Host</a></li>
</ul>

<blockquote>
  <p><strong>Note:</strong> If you choose to increase the scale of your ingress, you will need to ensure that there are at least the equivalent number of hosts available in your Kubernetes environment that have the port available.</p>
</blockquote>

<h4 id="setting-up-a-simple-service">Setting up a Simple Service</h4>

<p>Before setting up any ingress, services will need to be created in Kubernetes. We’ll start by adding a service and replication controller into our Kubernetes environment.</p>

<p>Here’s a simple nginx service to add into Kubernetes.</p>

<p>Example <code class="highlighter-rouge">nginx-service.yml</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">port</span><span class="pi">:</span> <span class="s">90</span>
    <span class="s">targetPort</span><span class="pi">:</span> <span class="s">80</span>
    <span class="s">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="nn">---</span>
<span class="s">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">ReplicationController</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">replicas</span><span class="pi">:</span> <span class="s">1</span>
  <span class="s">selector</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="s">60</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">nginx-service</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
        <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">containerPort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>Using <code class="highlighter-rouge">kubectl</code>, let’s launch our nginx service into Kubernetes. Remember, you can either <a href="/docs/rancher/v1.6/en/kubernetes/#kubectl">configure <code class="highlighter-rouge">kubectl</code> for your local machine</a> or you can use the shell in the UI under <strong>Kubernetes</strong> -&gt; <strong>kubectl</strong>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f nginx-service.yml
service <span class="s2">"nginx-service"</span> created
replicationcontroller <span class="s2">"nginx-service"</span> created
</code></pre>
</div>
<p><a id="scale-and-other-port"></a></p>

<h4 id="example-of-2-load-balancers-using-an-alternative-port">Example of 2 Load Balancers using an Alternative Port</h4>

<p>You can set up a ingress that is launched using 2 load balancers on 2 different hosts that uses a port, <code class="highlighter-rouge">99</code>, instead of the default ingress port <code class="highlighter-rouge">80</code>. For this ingress to work correctly, your kubernetes environment will need at least 2 hosts that have port <code class="highlighter-rouge">99</code> available.</p>

<p>Example <code class="highlighter-rouge">scaled-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">scaledlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Scaling to 2 load balancer instances</span>
    <span class="s">scale</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2"</span>
    <span class="c1"># Using a different port (not 80)</span>
    <span class="s">http.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">99"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>Let’s create the ingress using <code class="highlighter-rouge">kubectl</code>. After you create the ingress, the ingress controller will trigger the load balancer service to be created and visible in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab. Since the <code class="highlighter-rouge">scale</code> is set to <code class="highlighter-rouge">2</code> in the ingress, the load balancer service will have 2 instances of the load balancer deployed.</p>

<p>From <code class="highlighter-rouge">kubectl</code>, you can see the ingress created, but the UI will only show the load balancer. The ingress controller has already done all the translations of the requests in the ingress to a Rancher load balancer. Since there are 2 load balancers, there will be 2 addresses set in the ingress.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f scaled-ingress.yml
ingress <span class="s2">"host-based-ingress"</span> created
<span class="gp">$ </span>kubectl get ingress
NAME       RULE      BACKEND            ADDRESS             AGE
simplelb   -         nginx-service:90   1.2.3.4,5.6.7.8     41s
</code></pre>
</div>

<p><a id="tls"></a></p>

<h4 id="example-using-tls">Example using TLS</h4>

<p>If you want to use TLS with Kubernetes, you’ll need to <a href="/docs/rancher/v1.6/en/environments/certificates/">add the certifcate</a> into Rancher. The certificate added into Rancher can be used to secure an ingress for TLS termination.</p>

<p>Let’s say we added a certificate called <code class="highlighter-rouge">foo</code>.</p>

<p>Example <code class="highlighter-rouge">tls-ingress.yml</code> using the <code class="highlighter-rouge">foo</code> certificate</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">tlslb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="s">https.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">444"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">tls</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">secretName</span><span class="pi">:</span> <span class="s">foo</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>

<p>Let’s create the ingress using <code class="highlighter-rouge">kubectl</code>. After you create the ingress, the ingress controller will trigger the load balancer service to be created and visible in the <strong>kubernetes-ingress-lbs</strong> stack within the <strong>Kubernetes</strong> -&gt; <strong>System</strong> tab. By default, the load balancer service will only have 1 instance of the load balancer deployed.</p>

<p>From <code class="highlighter-rouge">kubectl</code>, you can see the ingress created, but the UI will only show the load balancer. The ingress controller has already done all the translations of the requests in the ingress to a Rancher load balancer.</p>

<p><a id="blocking-http"></a></p>

<h5 id="blocking-http">Blocking HTTP</h5>

<p>By default, port <code class="highlighter-rouge">80</code> is accessible even if a TLS is being used. In order to block port <code class="highlighter-rouge">80</code>, you can add in additional annotation <code class="highlighter-rouge">allow.http: "false"</code> as part of the ingress template.</p>

<p>Example <code class="highlighter-rouge">tls-ingress.yml</code> and blocking port <code class="highlighter-rouge">80</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">tlslb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="s">https.port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">444"</span>
    <span class="c1"># Added to block HTTP</span>
    <span class="s">allow.http</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">tls</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">secretName</span><span class="pi">:</span> <span class="s">foo</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">90</span>
</code></pre>
</div>
<p><a id="custom-haproxy"></a></p>

<h4 id="example-customization">Example customization</h4>

<p>In Rancher, our load balancers run HAProxy software. If you want to customize the <code class="highlighter-rouge">global</code> and <code class="highlighter-rouge">defaults</code> sections of the load balancer, they can be configured through ingress annotations.</p>

<p>Example <code class="highlighter-rouge">custom-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">customlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Customizing HAProxy in the load balancer</span>
    <span class="s">config</span><span class="pi">:</span> <span class="s2">"</span><span class="s">defaults</span><span class="se">\n</span><span class="s">balance</span><span class="nv"> </span><span class="s">source</span><span class="se">\n</span><span class="s">timeout</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">70000</span><span class="se">\n</span><span class="s">global</span><span class="se">\n</span><span class="s">maxconnrate</span><span class="nv"> </span><span class="s">60"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p>In our configuration, the <code class="highlighter-rouge">defaults</code> and <code class="highlighter-rouge">global</code> keywords identify the customizable sections and should be followed by a new line. Every parameter in these sections should be followed by a new line.</p>

<p><a id="scheduled-globally"></a></p>

<h4 id="example-of-a-load-balancer-scheduled-on-all-hosts">Example of a Load Balancer Scheduled on All Hosts</h4>

<p>You can schedule load balancers to be launched on all hosts in an environment. These global load balancers can be scheduled using an annotation, i.e. <code class="highlighter-rouge">io.rancher.scheduler.global: "true"</code>.</p>

<p>Example <code class="highlighter-rouge">global-ingress.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">globallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Create load balancers on every host in the environment</span>
    <span class="s">io.rancher.scheduler.global</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p><a id="host-scheduling"></a></p>

<h4 id="example-of-scheduling-a-load-balancer-on-a-host">Example of Scheduling a Load Balancer on a Host</h4>

<p>You can schedule load balancers to specific hosts in an environment. To schedule your load balancers to specific hosts, you would need to add labels to the host. A label on a host is a key value pair. For example, you could have a host with a label <code class="highlighter-rouge">foo=bar</code>. After the label is added to the host, you would use an annotation, i.e. <code class="highlighter-rouge">io.rancher.scheduler.affinity.host_label: "foo=bar"</code>, to schedule load balancer containers onto the labeled host.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">scheduledlb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Search for a host that has label foo=bar and schedule the load balancer on that host.</span>
    <span class="s">io.rancher.scheduler.affinity.host_label</span><span class="pi">:</span> <span class="s2">"</span><span class="s">foo=bar"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p><a id="only-local"></a></p>

<h4 id="example-of-directing-traffic-to-only-containers-on-the-same-host">Example of Directing traffic to only Containers on the same host</h4>

<p>You can configure load balancers to route traffic to <strong>only</strong> containers of a service that are on the same host of the load balancer container. If there are no containers of the target service on the host, then the load balancer does not route any traffic to the other containers of the target service as they are on other hosts. In order to configure the load balancer, you would use an annotation, i.e. <code class="highlighter-rouge">io.rancher.lb_service.target: "only-local"</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">onlylocallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Direct traffic to only containers that are on the same host as the load balancer container</span>
    <span class="s">io.rancher.lb_service.target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">only-local"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<p><a id="prefer-local"></a></p>

<h4 id="example-of-prioritizing-traffic-to-containers-on-the-same-host">Example of prioritizing traffic to Containers on the same host</h4>

<p>You can configure load balancers to prioritize traffic to containers of a service that are on the same host of the load balancer container. If there are no containers of the target service on the host, then the load balancer directs traffic to the other containers of the target service, that are on other hosts. In order to configure the load balancer, you would use an annotation, i.e. <code class="highlighter-rouge">io.rancher.lb_service.target: "prefer-local"</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">preferlocallb</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Prioritize traffic to containers that are on the same host as the load balancer container</span>
    <span class="s">io.rancher.lb_service.target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">prefer-local"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>

<h4 id="example-of-sticky-sessions">Example of sticky sessions</h4>

<p>The stickiness policy of the HAProxy software running inside Rancher’s load balancers can be configured. For example, you can configure the load balancers to route traffic from the same source to the same container. In order to configure the load balancer, you would use an annotation (i.e. <code class="highlighter-rouge">io.rancher.stickiness.policy</code>) and include the stickiness policy. The value can be set to a <code class="highlighter-rouge">\n</code> delimited set of key value parameters that are understood by HAProxy software.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">test</span>
  <span class="s">annotations</span><span class="pi">:</span>
    <span class="c1"># Configure stickiness policy</span>
    <span class="s">io.rancher.stickiness.policy</span><span class="pi">:</span> <span class="s2">"</span><span class="s">name:</span><span class="nv"> </span><span class="s">testname</span><span class="se">\n</span><span class="nv"> </span><span class="s">cookie:</span><span class="nv"> </span><span class="s">cookie123</span><span class="se">\n</span><span class="s">domain:</span><span class="nv"> </span><span class="s">test.domain"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">backend</span><span class="pi">:</span>
    <span class="s">serviceName</span><span class="pi">:</span> <span class="s">nginx-service</span>
    <span class="s">servicePort</span><span class="pi">:</span> <span class="s">80</span>
</code></pre>
</div>


          <footer class="clearfix">
            <div class="copyright pull-left">Copyright &copy; 2014-2017 <a href="http://rancher.com">Rancher Labs</a>.  All Rights Reserved.</div>
            <a class="btn btn-primary pull-right" href="https://github.com/rancher/rancher.github.io/tree/master/rancher/v2.0/en/kubernetes/ingress/index.md">Edit this page <i class="fa fa-pencil"></i></a>
          </footer>
        </div>
      </div>
    </div>

    <script src="/docs/vendor/jquery.js?t=2017-09-13 18:12:52 -0700"></script>
    <script src="/docs/js/jquery.slicknav.min.js?t=2017-09-13 18:12:52 -0700"></script>
    <script src="/docs/js/rancher-docs.js?t=2017-09-13 18:12:52 -0700"></script>

    <!-- Start of Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-56382716-3', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End of Google Analytics -->

    <!-- Start of Async HubSpot Analytics Code -->
    <script type="text/javascript">
    (function(d,s,i,r) {
    if (d.getElementById(i)){return;}
    var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
    n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/468859.js';
    e.parentNode.insertBefore(n, e);
    })(document,"script","hs-analytics",300000);
    </script>
    <!-- End of Async HubSpot Analytics Code -->
  </body>
</html>

