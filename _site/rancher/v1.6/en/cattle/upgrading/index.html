<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Upgrading using Rancher Compose</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for Rancher">
    <link href="/docs/favicon.png" rel="shortcut icon" type="image/png" sizes="16x16">
    <link href="/docs/css/syntax.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/vendor/font-awesome/css/font-awesome.min.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/vendor/lato/lato.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/lacsso.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/slicknav.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
    <link href="/docs/css/rancher-docs.css?t=2017-09-13 18:12:52 -0700" rel="stylesheet">
  </head>
  <body class="bg-default">
    <div class="row body">
      <header id="header" class="section">
        <nav class="row" role="navigation">
          <div class="col span-3">
          <a class="navbar-brand" href="/"><img src="/docs/img/rancher-logo-nopadding.svg" width="200px" style="padding-left: 20px" /></a>
          </div>

          <div class="col span-5 offset-3">
            <!--Start Google Search-->
            <div class="gcse-search" id="google-search"></div>
            <script>
              var match = window.location.pathname.match(/\/rancher\/([^\/]+)/);
              if ( match ) {
                document.getElementById('google-search').setAttribute('data-defaultToRefinement', match[1]);
              }

              (function() {
                var cx = '007896692384436596364:60akf3bfmxm';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <!--End Google Search-->
          </div>
        </nav>
      </header>
      <div class="col span-3 mt-0 mr-0 sidebar">

<ul id="menu">
    <li><a href="/docs/rancher/v1.6/en/">Overview</a></li>
    <li><a href="/docs/rancher/v1.6/en/quick-start-guide/">Quick Start Guide</a></li>
    <li>
        <a href="#">Installing Rancher<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/">Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#requirements">Rancher Server Requirements</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#rancher-server-tags">Rancher Server Tags</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container">Launching Rancher Server</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#multi-nodes">Setting up HA</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#requirements-for-ha">HA Requirements</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container-external-database">Using an External DB</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#single-container-bind-mount">Bind Mounted MySQL Volume</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#elb">Using an ELB in AWS</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#ldap">Using LDAP/AD with TLS</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/#http-proxy">Behind an HTTP Proxy</a></li>
          <li><a href="/docs/rancher/v1.6/en/installing-rancher/selinux/">SELinux Requirements for RHEL/CentOS</a></li>
          <li>
               <a href="#">Basic SSL Configuration<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#requirements">Requirements</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-nginx-configuration">Example NGINX Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-apache-configuration">Example Apache Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-haproxy-configuration">Example HAProxy Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#example-f5-big-ip-configuration">Example F5 BIG-IP Configuration</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#elb">Using an ELB in AWS with SSL</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/basic-ssl-config/#using-self-signed-certs-beta">Using Self Signed Certs</a></li>
               </ul>
          </li>
          <li>
               <a href="#">No Internet Access<i class="pull-right fa fa-angle-down"></i></a>
               <ul>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/no-internet-access/#using-a-private-registry">Using a Private Registry</a></li>
                 <li><a href="/docs/rancher/v1.6/en/installing-rancher/installing-server/no-internet-access/#using-an-http-proxy">Using an HTTP Proxy</a></li>
               </ul>
          </li>
        </ul>
    </li>
    <li>
         <a href="#">Upgrading Rancher<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li><a href="/docs/rancher/v1.6/en/upgrading/">Upgrading Rancher</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#rancher-server-tags">Rancher Server Tags</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#infrastructure-services">Upgrading Infrastructure Services</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#multi-nodes">Upgrading Rancher HA Setup</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#single-container-external-database">Using an external DB</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#single-container-bind-mount">Bind Mounted MySQL Volume</a></li>
           <li><a href="/docs/rancher/v1.6/en/upgrading/#rancher-server-with-no-internet-access">No Internet Access</a></li>
        </ul>
     </li>
    <li>
         <a href="#">Rancher Configuration<i class="pull-right fa fa-angle-down"></i></a>
         <ul>
           <li>
                <a href="#">Access Control Providers<i class="pull-right fa fa-angle-down"></i></a>
                <ul>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#active-directory">Active Directory</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#azure-ad">Azure AD</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#github">Github</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#local-authentication">Local Authentication</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#openldap">OpenLDAP</a></li>
                  <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#shibboleth">Shibboleth/SAML</a></li>
                </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#site-access">Rancher Site Access</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/access-control/#restricting-concurrent-sessions">Restricting Concurrent Sessions</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/accounts/">Accounts</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/settings/#host-registration">Host Registration</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/settings/#catalog">Enabling Catalogs</a></li>
          <li><a href="/docs/rancher/v1.6/en/configuration/machine-drivers/">Machine Drivers</a></li>
        </ul>
    </li>
    <li>
          <a href="#">Environments<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
            <li><a href="/docs/rancher/v1.6/en/environments/">Managing Environments</a></li>
            <li><a href="/docs/rancher/v1.6/en/environments/#what-is-an-environment-template">Environment Templates</a></li>
            <li><a href="/docs/rancher/v1.6/en/environments/#membership-roles">Roles in an Environment</a></li>
          </ul>
    </li>
    <li>
        <a href="#">Hosts<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
          <li><a href="/docs/rancher/v1.6/en/hosts/">Getting Started with Hosts</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#supported-docker-versions">Supported Docker Versions</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#host-labels">Adding Host Labels</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#scheduler-ips">Adding Scheduler IPs</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#hosts-behind-an-http-proxy">Behind an HTTP Proxy</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/custom/">Adding Custom Hosts</a></li>
          <li>
              <a href="#">Adding Cloud Provided Hosts<i class="pull-right fa fa-angle-down"></i></a>
              <ul>
                <li><a href="/docs/rancher/v1.6/en/hosts/amazon/">Adding Amazon EC2 Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/azure/">Adding Azure Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/digitalocean/">Adding DigitalOcean Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/exoscale/">Adding Exoscale Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/packet/">Adding Packet Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/rackspace/">Adding Rackspace Hosts</a></li>
                <li><a href="/docs/rancher/v1.6/en/hosts/other/">Adding Hosts from Other Cloud Providers</a></li>
              </ul>
          </li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#accessing-hosts-from-the-cloud-providers">Accessing Cloud Provided Hosts</a></li>
          <li><a href="/docs/rancher/v1.6/en/hosts/#removing-hosts">Removing Hosts</a></li>
        </ul>
    </li>
    <li>
      <a href="#">Registries<i class="pull-right fa fa-angle-down"></i></a>
      <ul>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/">Adding Private Registries</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#insecure-registries">Insecure Registries</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#self-signed-certificates">Self Signed Certificates</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#using-amazons-ecr-registry">Using Amazon's ECR</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#using-google-container-registry">Using Google Container Registry</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#changing-the-default-registry">Changing the Default Registry</a></li>
        <li><a href="/docs/rancher/v1.6/en/environments/registries/#limiting-which-registries-can-be-used">Limiting Registries</a></li>
      </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/environments/certificates/">Certificates</a></li>
    <li>
      <a href="#">Infrastructure Services<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/">Infrastructure Services</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/networking/">Networking</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/network-policy/">Network Policies</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/load-balancer">Load Balancer</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/dns-service/">DNS Service</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/metadata-service/">Metadata Service</a></li>
              <li>
                  <a href="#">Persistent Storage Service<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/">Persistent Storage Service</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/rancher-nfs/">Rancher NFS</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/storage-service/rancher-ebs/">Rancher EBS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">External Scheduler<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/">External Scheduler</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#multiple-ips">Scheduling against multiple IPs</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#resource-constraints">Scheduling with Resource Constraints</a></li>
                      <li><a href="/docs/rancher/v1.6/en/rancher-services/scheduler/#restrict-services-on-host">Scheduling only Specific Services on a Host</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/audit-log/">Audit Logging</a></li>
              <li><a href="/docs/rancher/v1.6/en/rancher-services/service-accounts/">Service Accounts</a></li>
           </ul>
    </li>
    <li>
          <a href="#">Cattle<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
                <li><a href="/docs/rancher/v1.6/en/cattle/stacks/">Stacks</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-services/">Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/volumes/">Volumes</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/">Load Balancers</a></li>
                <li>
                    <a href="#">Load Balancer Options in the UI<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#adding-a-load-balancer-in-the-ui">Adding Load Balancers</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#service-rule">Targeting Specific Services</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#selector-rule">Targeting Services based on Selectors</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#ssl-termination">SSL Termination</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#stickiness-policy-for-load-balancers">Stickiness Policy</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#custom-haproxy-configuration">Custom HAProxy Configuration</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#labelsscheduling-load-balancers">Labels and Scheduling</a></li>
                      </ul>
                </li>
                <li>
                    <a href="#">Load Balancer Options with CLI and Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#adding-a-load-balancer-with-rancher-compose">Adding Load Balancers</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#source-ports">Defining Source Ports</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#port-rules">Port Rules</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#certificates">Certificates</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#custom-configuration">Custom HAProxy Configuration</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#stickiness-policy">Stickiness Policy</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#load-balancer-example-l7">Example of L7 Load Balancer</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#internal-load-balancer-example">Example of Internal Load Balancer</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/adding-load-balancers/#ssl-termination-example">Example of SSL Termination with a Load Balancer</a></li>
                      </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-external-services/">External Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/adding-service-alias/">Service Alias</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/health-checks/">Health Checks</a></li>
                <li>
                    <a href="#">Scheduling Services<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/">Scheduling</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#scheduling-options-in-the-ui">Scheduling in the UI</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#adding-labels-in-rancher-compose">Scheduling in Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/scheduling/#table-of-scheduling-labels">Table of Scheduling Labels</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/upgrading/">Upgrading Services</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/internal-dns-service/">Internal DNS Service in Cattle Environments</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/external-dns-service/">External DNS Service</a></li>
                <li>
                    <a href="#">Rancher-Compose<i class="pull-right fa fa-angle-down"></i></a>
                    <ul>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/">Rancher Compose</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/commands/">Commands and Options</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/environment-interpolation/">Environment Interpolation</a></li>
                        <li><a href="/docs/rancher/v1.6/en/cattle/rancher-compose/build/">Building with AWS S3</a></li>
                    </ul>
                </li>
                <li><a href="/docs/rancher/v1.6/en/cattle/secrets/">Secrets - Experimental</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/webhook-service/">Webhooks</a></li>
                <li><a href="/docs/rancher/v1.6/en/cattle/labels/">Labels in Cattle</a></li>
          </ul>
    </li>
    <li>
          <a href="#">Kubernetes<i class="pull-right fa fa-angle-down"></i></a>
          <ul>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/">Launching Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/resiliency-planes/">Resiliency Planes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/providers/">Cloud Providers</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/private-registry/">Private Registry</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/rbac/">RBAC</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/disaster-recovery/">Disaster Recovery</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/backups/">Backups</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/storage/">Persistent Storage</a></li>
              <li>
                  <a href="#">Add-ons Support<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/">Add-ons Support</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/#helm">Helm</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/addons/#skydns">SkyDNS</a></li>
                  </ul>
              </li>
              <li>
                  <a href="#">Ingress Support and Options<i class="pull-right fa fa-angle-down"></i></a>
                  <ul>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/">Ingress Support</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#host-based-routing">Host Based Routing</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#path-based-routing">Path Based Routing</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#scale-and-other-port">Multiple Load Balancers and Selecting Ports</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#tls">Using TLS</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#blocking-http">Blocking HTTP</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#custom-haproxy">Custom HAProxy</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#scheduled-globally">Scheduling on all Hosts</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#host-scheduling">Scheduling on a specific Host</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#only-local">Targeting Only Containers on the Same Host</a></li>
                      <li><a href="/docs/rancher/v1.6/en/kubernetes/ingress/#prefer-local">Prioritizing Containers on the Same Host</a></li>
                  </ul>
              </li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/upgrading/">Upgrading Kubernetes</a></li>
              <li><a href="/docs/rancher/v1.6/en/kubernetes/deleting/">Deleting Kubernetes</a></li>

          </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/mesos/">Mesos</a></li>
    <li><a href="/docs/rancher/v1.6/en/swarm/">Swarm - Experimental </a></li>
    <li><a href="/docs/rancher/v1.6/en/windows/">Windows - Experimental</a></li>
    <li><a href="/docs/rancher/v1.6/en/native-docker/">Using Native Docker CLI</a></li>
    <li>
            <a href="#">Rancher Catalog<i class="pull-right fa fa-angle-down"></i></a>
            <ul>
                <li><a href="/docs/rancher/v1.6/en/catalog/">Catalog</a></li>
                <li><a href="/docs/rancher/v1.6/en/catalog/private-catalog/">Creating Private Catalogs</a></li>
            </ul>
        </li>
    <li><a href="#">Rancher CLI<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/en/cli/">Rancher CLI</a></li>
            <li><a href="/docs/rancher/v1.6/en/cli/commands/">Commands and Options</a></li>
            <li><a href="/docs/rancher/v1.6/en/cli/variable-interpolation/">Variable Interpolation</a></li>
        </ul>
    </li>
    <li><a href="/docs/rancher/v1.6/en/api/v2-beta/">API Documentation</a></li>
    <li><a href="/docs/rancher/v1.6/en/contributing/">Contributing to Rancher</a></li>
    <li>
        <a href="#">FAQs<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.6/en/faqs/server/">FAQs about Rancher Server</a></li>
            <li><a href="/docs/rancher/v1.6/en/faqs/agents/">FAQs about Rancher Agents/Hosts</a></li>
            <li><a href="/docs/rancher/v1.6/en/faqs/troubleshooting/">Troubleshooting FAQS</a></li>
        </ul>
    </li>
    <li>
        <a href="#">Docs Archive<i class="pull-right fa fa-angle-down"></i></a>
        <ul>
            <li><a href="/docs/rancher/v1.5/en/">Rancher v1.5</a></li>
            <li><a href="/docs/rancher/v1.4/en/">Rancher v1.4</a></li>
            <li><a href="/docs/rancher/v1.3/en/">Rancher v1.3</a></li>
            <li><a href="/docs/rancher/v1.2/en/">Rancher v1.2</a></li>
            <li><a href="/docs/rancher/v1.1/en/">Rancher v1.1</a></li>
            <li><a href="/docs/rancher/v1.0/en/">Rancher v1.0</a></li>
        </ul>
    </li>
</ul>

      </div>

      <div class="col span-8">
        <div class="content-container">
          <h2 id="upgrading-services">Upgrading Services</h2>
<hr />

<p>After launching <a href="/docs/rancher/v1.6/en/cattle/adding-services/">services</a>, you may have decided you want to change your service to update your application. For example, the image may have been updated and you want to launch an updated version of the service. As Docker containers are immutable, in order to change your service, you will need to destroy the old containers and launch new containers. Rancher provides two methods of upgrade. The recommended <a href="#in-service-upgrade">in-service upgrade</a> allows you to stop the old containers and start new containers in the same service name. An in-service upgrade is the only type of upgrade supported in the <a href="#upgrading-services-in-the-ui">UI</a>, and it is also supported in <a href="#upgrading-services-with-rancher-compose">Rancher Compose</a>. The <a href="#rolling-upgrade">rolling upgrade</a> is only supported through Rancher Compose, which removes the old service and creates a brand new service.</p>

<blockquote>
  <p><strong>Note:</strong> If you are looking to increase the scale of your service, you can either edit the scale of the service in the UI or use <code class="highlighter-rouge">rancher-compose scale &lt;serviceName&gt;=&lt;newNumber&gt;</code>.</p>
</blockquote>

<h3 id="in-service-upgrade">In-Service Upgrade</h3>

<h4 id="upgrading-services-in-the-ui">Upgrading Services in the UI</h4>

<p>Any service can be upgraded through the UI. Similar to <a href="/docs/rancher/v1.6/en/cattle/adding-services/">launching services</a>, the service will have all the Docker options that were previously selected and you will be able to update them to any new value. There are also a couple of upgrade options:</p>

<ul>
  <li><strong>Batch Size</strong>: The number of containers that you want stopped from the old service and started from the new service at one time.</li>
  <li><strong>Batch Interval</strong>: The amount of time between stopping containers from the old service and starting containers in the new service.</li>
  <li><strong>Start Behavior</strong>: By default, the old containers will stop before starting to launch new containers. You can select to allow the new containers to be started before the old containers are stopped.</li>
</ul>

<p>After selecting your upgrade options and defining your new service, select <strong>Upgrade</strong>.</p>

<p>Once all the old containers have been stopped and the new containers have become active, the service will be in an <em>Upgraded</em> state. At this stage, you should test your new service to ensure it’s working as expected before selecting <strong>Finish Upgrade</strong>. If your new service isn’t what you expected, you have the ability to <strong>Rollback</strong> to the original service.</p>

<h4 id="upgrading-services-with-rancher-compose">Upgrading Services with Rancher Compose</h4>

<p>With Rancher Compose, if you have chosen to do an in-service upgrade, the containers in existing services are upgraded to the provided <code class="highlighter-rouge">docker-compose.yml</code> and the original containers in the service are removed. In order to perform this action, upgrade options are passed in during a <code class="highlighter-rouge">rancher-compose up</code> command. By adding the <code class="highlighter-rouge">--upgrade</code> option, the  <code class="highlighter-rouge">docker-compose.yml</code> will upgrade any services, that have the same name, in the stack to the new service definition. Just like in the UI, the in-service upgrade is a two step process as we require the user to confirm the upgrade is okay.</p>

<h5 id="step-1-performing-the-upgrade">Step 1: Performing the Upgrade</h5>

<p>For an upgrade, you can upgrade an entire stack or specific services within the <code class="highlighter-rouge">docker-compose.yml</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Upgrades all services in the stack (i.e. docker-compose.yml)</span>
<span class="gp">$ </span>rancher-compose up --upgrade
<span class="c"># Upgrade specific services (i.e. service1 and service2)</span>
<span class="gp">$ </span>rancher-compose up --upgrade service1 service2
<span class="c"># Force an upgrade even though the docker-compose.yml for the services didn't change</span>
<span class="gp">$ </span>rancher-compose up --force-upgrade
</code></pre>
</div>
<p><strong>Upgrade Options</strong></p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">--pull</code>, <code class="highlighter-rouge">-p</code></td>
      <td>Before doing the upgrade do an image pull on all hosts that have the image already</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">-d</code></td>
      <td>Do not block and log</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--upgrade</code>, <code class="highlighter-rouge">-u</code>, <code class="highlighter-rouge">--recreate</code></td>
      <td>Upgrade if service has changed</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--force-upgrade</code>, <code class="highlighter-rouge">--force-recreate</code></td>
      <td>Upgrade regardless if service has changed</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--confirm-upgrade</code>, <code class="highlighter-rouge">-c</code></td>
      <td>Confirm that the upgrade was success and delete old containers</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--rollback</code>, <code class="highlighter-rouge">-r</code></td>
      <td>Rollback to the previous deployed version</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--batch-size</code> “2”</td>
      <td>Number of containers to upgrade at once</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--interval</code> “1000”</td>
      <td>Update interval in milliseconds</td>
    </tr>
  </tbody>
</table>

<p><br /><br />
<strong>Pull</strong></p>

<p>During your upgrade, you can also perform a <code class="highlighter-rouge">docker pull</code> before the images are deployed. Since the hosts would typically have your image already cached, you might want to add in the <code class="highlighter-rouge">--pull</code> option to pull the most up-to-date images on your hosts.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># During upgrade, force a pull to the host for latest images</span>
<span class="gp">$ </span>rancher-compose up --upgrade --pull
</code></pre>
</div>

<p><strong>Batch Size</strong></p>

<p>By default, containers of the new service are started 2 at a time during an upgrade. You can change how many containers you want upgraded at a time, by passing in <code class="highlighter-rouge">--batch-size</code> and a number. This number is how many containers will be started in the new service during the upgrade process.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Containers of service2 will be started in batches of 3</span>
<span class="c"># until the scale of the service2 is reached</span>
<span class="gp">$ </span>rancher-compose up --upgrade --batch-size 3
</code></pre>
</div>

<p><strong>Interval</strong></p>

<p>By default, during the upgrade, there is a 2 second wait between when containers on the new service have started and when containers on the old service are removed. You can override this interval by passing in <code class="highlighter-rouge">--interval</code> and the number of milliseconds for the interval.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Set the interval to 30 seconds, which is the time between</span>
<span class="c"># when the containers of the new service have started and</span>
<span class="c"># when the containers of the old service are removed</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --interval <span class="s2">"30000"</span>
</code></pre>
</div>

<p><strong>Starting New Containers Before Stopping Old Containers</strong></p>

<p>By default, the in-service upgrade stops the existing containers, and then launch the new containers. To start the new containers before stopping the old containers, you must provide additional content in the <code class="highlighter-rouge">rancher-compose.yml</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
<span class="s">services</span><span class="pi">:</span>
  <span class="s">myservice</span><span class="pi">:</span>
    <span class="s">upgrade_strategy</span><span class="pi">:</span>
      <span class="s">start_first</span><span class="pi">:</span> <span class="s">true</span>
</code></pre>
</div>

<p><br /></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Upgrading myservice with the above yaml will start the new service first</span>
<span class="gp">$ </span>rancher-compose up --upgrade myservice
</code></pre>
</div>

<h5 id="step-2-confirming-the-upgrade">Step 2: Confirming the upgrade</h5>

<p>Once you have verified the upgrade passes your validation, you will need to confirm that the upgrade is complete. The confirmation is required as it allows users to rollback to their old versions if necessary. <strong>Once you have confirmed the upgrade, rolling back to the old version is no longer possible.</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Confirm that the upgrade is complete and successful</span>
<span class="gp">$ </span>rancher-compose up --upgrade --confirm-upgrade
</code></pre>
</div>

<p><strong>Rolling Back</strong></p>

<p>After performing an upgrade, if your upgraded services have issues, Rancher provides the ability to roll back to your old service. This can only be accomplished if you have <strong>not</strong> confirmed your upgrade.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Roll back to previous version</span>
<span class="gp">$ </span>rancher-compose up --upgrade --rollback
</code></pre>
</div>

<h3 id="rolling-upgrade">Rolling Upgrade</h3>

<p>A rolling upgrade is when a new service is created to replace an existing old service. Instead of having containers be removed and new containers started in the same service, a completely new service would be created. This type of upgrade is only supported with Rancher Compose. The command to perform a rolling upgrade to a new service is easy:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rancher-compose upgrade service1 service2
</code></pre>
</div>

<p><code class="highlighter-rouge">service2</code> is the name of the new service that you want to start in Rancher. <code class="highlighter-rouge">service1</code> is the name of the service that you want stopped in Rancher. As <code class="highlighter-rouge">service2</code> is deployed, the containers in <code class="highlighter-rouge">service1</code> will be removed from Rancher. The service is not removed from Rancher, but the scale of the service will be brought to 0.</p>

<p>Inside the <code class="highlighter-rouge">docker-compose.yml</code>, both names of the services will need to be included. For <code class="highlighter-rouge">service1</code>, only the name of the service is required for Rancher Compose to find the service in Rancher. For <code class="highlighter-rouge">service2</code>, the service will need to be populated with all the details of the service in order for Rancher Compose to launch the service.</p>

<h4 id="example-docker-composeyml">Example <code class="highlighter-rouge">docker-compose.yml</code></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
<span class="s">services</span><span class="pi">:</span>
  <span class="s">service1</span><span class="pi">:</span>
  <span class="c1"># Nothing needs to actually be placed in the file as the service is already running</span>
  <span class="s">service2</span><span class="pi">:</span>
    <span class="s">image</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="s">links</span><span class="pi">:</span>
    <span class="c1"># Define any outbound links to other services in the stack</span>
    <span class="pi">-</span> <span class="s">db:mysql</span>
</code></pre>
</div>

<p>By default, any load balancers or services linked to <code class="highlighter-rouge">service1</code> (i.e. inbound links) will automatically be updated with a new link to <code class="highlighter-rouge">service2</code>. If you do not wish for these links to be created, you can <a href="/docs/rancher/v1.6/en/cattle/upgrading/#updating-inbound-links">set an option to not have them created</a>.</p>

<blockquote>
  <p><strong>Note:</strong> There is no need for a <code class="highlighter-rouge">rancher-compose.yml</code> file used while upgrading services. By default, the scale of the new service is based on the scale of the old service. You can override this scale by passing in the <code class="highlighter-rouge">--scale</code> option.</p>
</blockquote>

<h4 id="scaling-during-an-upgrade">Scaling during an Upgrade</h4>

<p>Containers are not removed from the old service until the sum of containers from the new service and old service have exceeded the final scale of the new service.</p>

<h4 id="example">Example:</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>rancher-compose upgrade service1 service2 --scale 5
</code></pre>
</div>

<p><code class="highlighter-rouge">service1</code> has a scale of 2 containers and is upgrading to <code class="highlighter-rouge">service2</code>, which will eventually have 5 containers.</p>

<table>
  <thead>
    <tr>
      <th><code class="highlighter-rouge">service1</code></th>
      <th><code class="highlighter-rouge">service2</code></th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2</td>
      <td>0</td>
      <td><code class="highlighter-rouge">service1</code> is running with 2 containers.</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td><code class="highlighter-rouge">service2</code> starts 2 containers at a time (Default <a href="#batch-size">Batch Size</a>).</td>
    </tr>
    <tr>
      <td>2</td>
      <td>4</td>
      <td><code class="highlighter-rouge">service2</code> starts another 2 containers.</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4</td>
      <td>After the previous step, the sum (6) of the new and old containers is greater than the final scale (5), <code class="highlighter-rouge">service1</code> stops and removes one of the containers to maintain the final scale of 5.</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5</td>
      <td><code class="highlighter-rouge">service2</code> starts only 1 container to reach the final scale of 5.</td>
    </tr>
    <tr>
      <td>0</td>
      <td>5</td>
      <td><code class="highlighter-rouge">service1</code> removes the last running container.</td>
    </tr>
  </tbody>
</table>

<h4 id="options-with-the-upgrade-command">Options with the <code class="highlighter-rouge">Upgrade</code> Command</h4>

<p>With the <code class="highlighter-rouge">upgrade</code> command, there are several options that can be passed in to customize your upgrade.</p>

<table>
  <thead>
    <tr>
      <th>Options</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">--batch-size</code> “2”</td>
      <td>Number of containers to upgrade at once</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--scale</code> “-1”</td>
      <td>Final number of running containers</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--interval</code> “2000”</td>
      <td>Update interval in milliseconds</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--update-links</code></td>
      <td>Update inbound links on target service</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--wait</code>, <code class="highlighter-rouge">-w</code></td>
      <td>Wait for upgrade to complete</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--pull</code>, <code class="highlighter-rouge">-p</code></td>
      <td>Before doing the upgrade do an image pull on all hosts that have the image already</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">--cleanup</code>, <code class="highlighter-rouge">-c</code></td>
      <td>Remove the original service definition once upgraded, implies –wait</td>
    </tr>
  </tbody>
</table>

<h5 id="batch-size">Batch Size</h5>

<p>By default, containers of the new service are started 2 at a time during an upgrade. You can change how many containers you want upgraded at a time, by passing in <code class="highlighter-rouge">--batch-size</code> and a number. This number is how many containers will be started in the new service during the upgrade process.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Containers of service2 will be started in batches of 3</span>
<span class="c"># until the scale of the service2 is reached</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --batch-size 3
</code></pre>
</div>

<h5 id="final-scale">Final Scale</h5>

<p>By default, the scale of a new service is based on the scale of the old service. You can change the scale of the new service by passing in <code class="highlighter-rouge">--scale</code> and a number. The number defines the final scale of running containers you want in the new service.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Setting the scale of service2 to 8 containers</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --scale 8
</code></pre>
</div>

<p><br /></p>

<blockquote>
  <p><strong>Note:</strong> The containers of the old service will not be removed based on batch size. After the containers are launched in a particular batch, containers of the old service are stopped and removed when the sum of containers in the old and new service exceed the final scale of the new service.</p>
</blockquote>

<h5 id="interval">Interval</h5>

<p>By default, during the upgrade, there is a 2 second wait between when containers on the new service have started and when containers on the old service are removed. You can override this interval by passing in <code class="highlighter-rouge">--interval</code> and the number of milliseconds for the interval.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Set the interval to 30 seconds, which is the time between</span>
<span class="c"># when the containers of the new service have started and</span>
<span class="c"># when the containers of the old service are removed</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --interval <span class="s2">"30000"</span>
</code></pre>
</div>

<h5 id="updating-inbound-links">Updating Inbound Links</h5>

<p>By default, any services that were linked <strong>TO</strong> the old service are also linked to the new service. If you don’t want any of these services to be linked to the new service, you can pass in <code class="highlighter-rouge">--update-links="false"</code> so that there will be no links to the new service.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Do not set the links to the old service in the set up of the new service</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --update-links<span class="o">=</span><span class="s2">"false"</span>
</code></pre>
</div>

<h5 id="waiting-for-upgrade-to-complete">Waiting for Upgrade to Complete</h5>

<p>By default, Rancher Compose will exit after the upgrade has been passed to Rancher, but the upgrade process may not have been completed. By passing in the <code class="highlighter-rouge">--wait</code> or <code class="highlighter-rouge">-w</code> to the <code class="highlighter-rouge">upgrade</code> command, Rancher Compose will not exit until after the new service has completely started and the old service has been stopped.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Wait for the upgrade to be completed</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --wait
</code></pre>
</div>

<h5 id="pulling-a-new-image">Pulling a new Image</h5>

<p>By default, Rancher Compose will not pull an image if the image already exists on the host. By passing in the <code class="highlighter-rouge">--pull</code> or <code class="highlighter-rouge">-p</code> to the <code class="highlighter-rouge">upgrade</code> command, Rancher Compose will pull the image again even if the image is already on the host.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Pull a new image even if image already exists</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --pull
</code></pre>
</div>

<h5 id="cleanup-original-service">Cleanup Original Service</h5>

<p>By default, the original service will remain in Rancher with a scale of 0 after the upgrade is complete. If you are positive that you will not need to rollback or save the original service definition, you can pass in the <code class="highlighter-rouge">--cleanup</code> or <code class="highlighter-rouge">-c</code> option with the <code class="highlighter-rouge">upgrade</code> command. This option implies that <code class="highlighter-rouge">--wait</code> as the Rancher Compose will wait for the upgrade to be completed before removing the service from Rancher.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Cleanup service1 from Rancher after upgrade is complete</span>
<span class="gp">$ </span>rancher-compose upgrade service1 service2 --cleanup
</code></pre>
</div>


          <footer class="clearfix">
            <div class="copyright pull-left">Copyright &copy; 2014-2017 <a href="http://rancher.com">Rancher Labs</a>.  All Rights Reserved.</div>
            <a class="btn btn-primary pull-right" href="https://github.com/rancher/rancher.github.io/tree/master/rancher/v1.6/en/cattle/upgrading/index.md">Edit this page <i class="fa fa-pencil"></i></a>
          </footer>
        </div>
      </div>
    </div>

    <script src="/docs/vendor/jquery.js?t=2017-09-13 18:12:52 -0700"></script>
    <script src="/docs/js/jquery.slicknav.min.js?t=2017-09-13 18:12:52 -0700"></script>
    <script src="/docs/js/rancher-docs.js?t=2017-09-13 18:12:52 -0700"></script>

    <!-- Start of Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-56382716-3', 'auto');
        ga('send', 'pageview');
    </script>
    <!-- End of Google Analytics -->

    <!-- Start of Async HubSpot Analytics Code -->
    <script type="text/javascript">
    (function(d,s,i,r) {
    if (d.getElementById(i)){return;}
    var n=d.createElement(s),e=d.getElementsByTagName(s)[0];
    n.id=i;n.src='//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/468859.js';
    e.parentNode.insertBefore(n, e);
    })(document,"script","hs-analytics",300000);
    </script>
    <!-- End of Async HubSpot Analytics Code -->
  </body>
</html>

